<!DOCTYPE html>
<html>
<head>
<script>
  // Global accessor that the popup uses.
  var hcards      = {};
  var hcalendars  = {};
  var hreviews    = {};
  var hrecipes    = {};

  chrome.extension.onRequest.addListener(function onRequest(request, sender, sendResponse) {
    var tabId         = sender.tab.id;
    hcards[tabId]     = request.hcards;
    hcalendars[tabId] = request.hcalendars;
    hreviews[tabId]   = request.hreviews;
    hrecipes[tabId]   = request.hrecipes;
    
    // convert JSON back to objects that the popup can use
    for (var i = 0; i < hcards[tabId].length; i++) {
      hcards[tabId][i] = JSON.parse(hcards[tabId][i]);
    }
    for (var j = 0; j < hcalendars[tabId].length; j++) {
      hcalendars[tabId][j] = JSON.parse(hcalendars[tabId][j]);
    }
    for (var k = 0; k < hreviews[tabId].length; k++) {
      hreviews[tabId][k] = JSON.parse(hreviews[tabId][k]);
    }
    for (var l = 0; l < hrecipes[tabId].length; l++) {
      hrecipes[tabId][l] = JSON.parse(hrecipes[tabId][l]);
    }
    
    // display the icon in the address bar
    if (hcards[tabId].length > 0 || hcalendars[tabId].length > 0 || hreviews[tabId].length > 0 || hrecipes[tabId].length > 0) {
      chrome.pageAction.show(tabId);      
    }
    
    // call sendResponse with an empty object to allow the request to be cleaned up
    sendResponse({});
  });
</script>
</head>
</html>
